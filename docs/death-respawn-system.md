# 重机枪游戏 - 死亡重生系统

## 功能概述

实现了完整的玩家死亡重生系统，包括动画效果、增强效果重置和重生机制。

## 主要功能

### 1. 死亡检测和处理
- 当玩家与敌人碰撞且没有护盾时，触发死亡流程
- 生命值减1，如果生命值>0则进入重生流程，否则游戏结束

### 2. 死亡动画效果
- 爆炸特效：在玩家位置显示死亡效果
- 屏幕震动：增强视觉冲击
- 倒计时文字：显示"💀 3秒后重生..."并逐秒倒计时
- 文字闪烁效果：增加紧张感

### 3. 增强效果重置
- **临时效果重置**：
  - 多重射击 (multiShot)
  - 护盾 (shield)
  - 清除视觉着色效果
  
- **永久增强重置**：
  - 射击间隔恢复到200ms
  - 移动速度恢复到300

### 4. 重生机制
- 玩家隐藏3秒钟
- 重生位置：屏幕底部中央 (x: 207, y: 636)
- 重生特效：
  - 蓝色光环扩散效果
  - 8个星光粒子向外发散

### 5. 无敌时间
- 重生后2秒无敌时间
- 闪烁效果（透明度在0.5-1.0之间切换）
- 无敌期间免疫敌人伤害

## 技术实现

### 核心文件修改

#### 1. `GameScene.js`
```javascript
// 新增方法
playerDeath()           // 处理死亡流程
resetPlayerEnhancements() // 重置增强效果
playDeathAnimation()    // 播放死亡动画
respawnPlayer()         // 处理重生
createRespawnEffect()   // 创建重生特效
```

#### 2. `Player.js`
```javascript
// 新增属性
isRespawning           // 重生状态标志
isInvincible          // 无敌状态标志

// 新增方法
resetAllEnhancements() // 重置所有增强效果

// 修改的方法
handleMovement()       // 重生时不处理移动
handleShooting()       // 重生时不射击
```

#### 3. `CollisionManager.js`
```javascript
// 修改碰撞检测
checkPlayerEnemyCollisions() // 跳过重生和无敌状态的碰撞
```

## 状态流转

```
正常游戏 → 碰撞检测 → 死亡判定 → 死亡动画 → 重置增强 → 隐藏玩家 → 
3秒倒计时 → 重生 → 重生特效 → 无敌时间 → 恢复正常
```

## 测试验证

### 自动化测试
- `death-respawn-test.spec.ts`：完整的功能测试
- `death-respawn-demo.spec.ts`：可视化演示

### 测试覆盖
- ✅ 增强效果激活和重置
- ✅ 死亡状态检测
- ✅ 重生时机和位置
- ✅ 无敌时间机制
- ✅ 生命值正确扣除
- ✅ 游戏结束条件

## 用户体验

### 视觉反馈
- 死亡时的爆炸效果和屏幕震动
- 清晰的倒计时提示
- 重生时的光环和星光特效
- 无敌时间的闪烁提示

### 游戏平衡
- 所有增强效果重置，确保公平性
- 2秒无敌时间，给玩家适应时间
- 重生位置固定，保证一致性

## 配置参数

```javascript
// 时间配置
RESPAWN_DELAY: 3000ms      // 重生延迟
INVINCIBLE_TIME: 2000ms    // 无敌时间
DEATH_EFFECT_DURATION: 500ms // 死亡特效时长

// 重生位置
RESPAWN_X: gameWidth / 2   // 屏幕中央
RESPAWN_Y: gameHeight - 100 // 底部偏上

// 初始属性
INITIAL_FIRE_RATE: 200ms   // 初始射击间隔
INITIAL_SPEED: 300         // 初始移动速度
```

## 使用说明

1. **正常游戏**：玩家可以收集各种增强道具
2. **死亡触发**：与敌人碰撞时（无护盾）触发死亡
3. **观看动画**：3秒倒计时期间观看死亡和重生动画
4. **重新开始**：重生后所有增强效果重置，需要重新收集道具
5. **无敌保护**：重生后2秒内闪烁提示无敌状态

这个系统为游戏增加了更好的反馈机制和公平的重新开始机制，提升了整体游戏体验。
